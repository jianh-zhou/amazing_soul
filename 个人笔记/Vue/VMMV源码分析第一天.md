# VMMV源码分析第一天

## 数据代理

### 实现原理

- 将自己的属性给实例对象使用,利用Object.defineProperty( )

### 1 为配置对象初始化,给实例对象添加一个$options属性,也就是说如果有传对象则直接使用该对象,否则定义一个空对象,赋值给$options属性

### 2 在实例时.将$options对象赋值赋值两次,一次给该实例对象的_data属性,一次给一个变量data接收

### 3 利用Object.keys(data)取出所有的属性值,然后对这个数组进行遍历,自forEach方法的回调函数中,调用该构造函数原型上的一个方法,并将当前这个属性名作为实参传入

### 4 执行该函数,将属性名传入到函数中使用,最终利用Object.defineProperty( )方法,为当前实例对象添加传入的属性名,通过该方法中的set方法将其设置对应的属性名,最终该方法执行完,就为该实例对象添加了一个对应的属性,根据循环一直添加,直到全部添加完毕

## 插值语法

### 原理

- 通过获取节点的类型,通过判断该类型执行不同的操作,如果是文本,而且符合插值语法的规范,调用对应的指令方法,最终将节点的内容替换为属性的值,实现插值语法的目的

### 1 在实例化VMMV对象时,会进入这个构造函数,执行其中的代码,在执行代码时,会给当前实例对象添加一个属性,该属性为Compile构造函数的实例对象,传入第一个参数是一个容器的标签名,或者body,第二个参数是当前实例对象

### 2 将传入的VMMV实例对象赋值给当前Compile实例对象的一个$vm属性,判断当前传入的第一个参数是否是一个元素对象,如果是是对象,则直接赋值,否则根据传入的选择器利用对应的方法获取当前选择器的对象

### 3 根据这个元素对象,创建一个文档碎片对象,使用一个while循环拿到该元素所有的子节点,最终将这个文档碎片对象返回,并且将该文档碎片对象赋值给当前实例对象的一个$fragment,在这个操作完成时,之前的容器元素对象上的所有节点都会剪切到这个文档碎片对象中

### 4 调用原型对象上的$init方法,然后进行一系列函数之间的互相调用,compileElement这个方法传入一个文档碎片对象模型,获取这个文档碎片对象的所有子节点,设置一个正则表达式匹配当前节点是否符合插值语法的规则,遍历这个所有子节点伪数组,遍历循环,将每个子节点,判断该节点的类型,     如果该节点是元素节点,则进行一系列的操作.如果该节点是一个文本节点,而且能够匹配到插值语法的格式.然后将这个子节点和当前插值语法表达式的值进行传入

### 5 调用指令处理集合的text方法,传入3个参数,一个是当前节点,一个是当前插值语法的的表达式的值,还有一个VMMV实例对象,然后该函数再次调用一个bind方法,该方法根据传入的类型,最后调用对应的方法,将当前节点的内容替换为对应的属性的属性值最终将该文档碎片对象擦插入到对应的节点中,然后将这个文档碎片对象插入到对应的标签中,最终渲染完成,展示页面

## 事件

### 原理

- 通过获取标签中的属性,然后判断指令的类型,最后通过拿取该属性的值进行操作,找到methods属性中对应的方法,为对应的节点绑定一个事件,然后再把对应指令属性删除,最终展示在页面,实现事件的绑定

### 5 如果该节点是元素节点,则调用compile方法,将该节点传入,获得该元素节点上所有属性节点,获得所有节点的一个伪数组,遍历该数组,并且获得每一个属性名

### 6 判断该属性名是不是以v-开头,如果是v-开头,则说明这个一个指令,获得这个属性值并且保存,并且将前面的v-去掉,获得一个新字符串

### 7 判断该字符串是否是以on开头,如果是on开头,则说明这是一个事件,那么就调用事件处理的一个方法,传入第一个参数元素节点,第二个参数是VMMV实例对象,第三个参数是属性值,第四个参数是属性名进行截取操做后的值,通过该函数进行操作

### 8 进入该函数,获取当前的属性值的事件类型,通过该类型,获取MVVM实例对象的方法中的回调函数,然后判断是否有该类型和回调函数,如果都满足,则直接使用addEventListener绑定事件,最终对这个节点绑定事件

### 9 在绑定完事件后,最后将指令属性删除掉

## 正则表达式

### 元字符

-    . 

	- 除了/n外所有的字符中的一个

- [  ]
- { }
- 
- 子主题 5
- 子主题 6
- 子主题 7
- 子主题 8
- 子主题 9
- 子主题 10
- 子主题 11

### 子主题 2

