# PC项目第7天

## 1 购物车商品数据

### 1 封装对应的api函数,请求购物车商品信息数据

- 1 请求方式get
- 2 接口/cart/cartList

### 2 将其添加到对应的vuex数据模块中

- 1 引入对应的api函数
- 2 给数据shopList设置一个初始值,为一个空数组
- 3 添加一个mutation方法,直接修改该数据的值
- 4 添加一个action方法,间接修改数据的值

	- 1 调用对应的请求数据的api函数
	- 2 判断返回值,如果code等于200,则说明数据请求成功,分发对应的mutaition,最终修改shopList数组

### 3 引入对应的mapState辅助函数,获取到的商品信息数组放入到计算属性中,

### 4 定义一个方法,用来分发请求商品信息数组的的action

### 5 在结构中使用v-for遍历,将请求回来的数据在页面进行展示渲染

## 2 根据商品信息数组在vuex中获取多个数据状态的get方法

### 1 商品选中的总数量

- 1 使用reduce遍历shopList,判断其是否被选中,根据isChecked属性,如果选中,则获取其中的skuNum属性进行然后进行操作

### 2 商品选中的总价钱

- 2 使用reduce遍历shopList数组

### 3 是否全选

- 使用every方法,最终返回一个布尔值,

	- 只有所有的元素都返回满足条件,最终返回布尔值ture,否则返回false

### 4 所有选中的商品信息数组

- 遍历所有数组,使用fifter方法,返回符合条件的数组集合

## 3 删除当前商品选项

### 1 封装对应的删除商品的api函数,并且在vuex中引入该函数

### 2 添加对应的action,传入对应的参数

- 参数1 {commit}
- 参数2 skuId

	- 商品的id

- 1 接收请求删除的返回值,使用await
- 2 判断返回值的状态,即判断返回结果的code是否等于200

	- 如果等于200.请求成功,说明删除成功

		- 返回一个空串

	- 如果不等于200 ,说明请求失败,也就是删除失败

		- 返回错误信息

### 3  在组件中分发给对应的标签添加一个事件,定义相应的(回调函数(方法)

-  1 方法是使用async 和 await实现异步回调的同步化
- 2 使用window.confim方法,询问用户是否确定删除,如果确定删除则执行对应代码
- 3 使用await接收分发action的返回值,在分发action时,传递一个skuId参数
- 4 根据分发action的返回结果

	- 1 返回是空串,代表删除成功,

		- 调用对应的方法,重新请求页面数据,更新页面

	- 2 返回的非空串,代表删除失败

		- 弹出对应的警告框,提示删除失败

## 4 删除当前所有选中的商品项

### 1 添加对应的action,传入对应的参数

- 参数1 {commit}
- 参数2 skuId

	- 商品的id

- 1 接收请求删除的返回值,调用删除的api函数接口.接收请求的返回值

	- 1 如果返回数据的code值不为200,代表请求失败,抛出一个错误,即分发对应的action的返回值是失败的promise

### 2 引入对应辅助函数mapGetters,在计算属性中使用辅助函数获取当前所有选中的商品的数组

### 2 给对应的标题添加一个点击事件,定义对应的方法

- 1 判断要删除的数据数组的长度是否大于0 ,如果小于0,则直接return返回
- 2 使用window.confirm,询问用户是否确定删除,

	- 如果确定,则执行后面的对应代码
	- 否则直接当前函数直接执行完

- 3 遍历当前的所有选中的商品的数组,在回调函数中,分发对应的action.传入对应的参数,使用一个变量接收,然后将这个返回值,添加到定义的一个空数组promises中
- 4 遍历完毕,使用Promise.all方法,将promises作为all方法的参数,接收返回值
- 5 使用then和返回值,进入太then的第一个回调函数,说明请全部删除成功,则调用对应的方法,更新页面数据
- 6 如果调用then方法的第二个回调函数,则弹出对应的警告框,提示删除失败

### 因为删除所有选中的商品没有一个固定的接口,只能通过删除一个个的方式来删除商品,如果在删除某一个的时候发生错误,就有可能出现问题,因为每一次循环删除都是会分发一个action,发送请求一次,中途删除失败,则最终给用户返回的结果是全部删除失败,但实际上,已经有一部分删除成功了,所以,如果后台不提供这样的接口,会出现一定的错误

## 5 当前商品是否选中

### 1 封装对应的api函数,请求商品的选中状态

- 接收两个参数

	- skuId 商品的id
	- isChecked  0或者1

- get方式

### 2 在vuex中,添加对应的action方法,

- 接收两个参数,

	- {commit}
	- {skuId,isChecked}

- 1 定义一个变量,接收返请求更改选中状态的结果
- 2 判断返回结果的code值是否等于200

	-  如果不等于200 ,则直接抛出一个错误

### 3 给对应的表单标签设置动态属性checked值,而不能使用v-model,因为v-model只能读,不能设置

- :checked="shop.isChecked"

### 4 给当前框绑定一个事件,定义一个方法

- 回调函数接收一个参数,就是当前商品的信息对象
- 1 设值isChecked的值,通过从传入的参数进行设置,如果为1,则让其为0,如果为0,则让其为1
- 2 直接分发对应的action,传递两个参数,参数以对象的形式传递,第一参数是商品的skuId,第二个参数是isChecked
- 3 使用then方法接收,

	-  执行第一回调函数,说明修改成功

		- 调用对应的方法,修改数据,最终页面更新

	- 执行第二个回调函数.

		- 弹出提示框,修改失败

## 6 是否全选

### 1 使用单个单个商品选中的api函数和对应的action

### 2  通过事件对象event,获取当前文本框的状态

-  const isChecked = e.target.checked * 1

### 3 使用map方法,映射当前所有商品信息数组该方法内部返回一个promise对象,每次返回都是分发一个action之后的返回值,最终返回一个数组,使用一个变量promises接收

### 4 使用try..catch接收

- try语句中,使用await Promise.all(promises)

	- 如果所有都是成功的promise对象,则会继续执行后面的代码,调用对应的数据更新的方法,更新页面

- 如果在执行try时.出现错误,则会进入到catch中,谈出对应的提示框

## 7 修改商品数量

### 1 定义对应的action

- 参数

	- {commit,dispatch}

		- 在action中 ,传入对应的dispatch,可以分发其他的action

	- { skuId, skuNum }

- 1 定义变量,接收对应的action,调用的api函数,就是请求添加购物车的api函数
- 2 判断返回值的状态,如果code等于200

	- 直接使用dispatch,分发对应请求购物列表的数据,

- 3 如果不等于200..则弹出对应的警告提示框

### 2 为+   -   和文本输入框都分别绑定对应的事件

- +

	- 单击
	- 参数

		- 参数1 shop  当前商品的数据对象
		- 参数2 变化量

			- 1

- input

	- change

		- 输入框失去改变内容,且失去焦点

	- 参数

		- 参数1 shop    当前商品的数据对象
		- 参数2 

			- $event.target.valu1e*1-shop.skuNum
			- 即当前文本框的内容,减去数据中的商品的数量

	- 使用动态的value属性,因为v-model不能获取设置

		- 子主题 1

- _

	- 单击
	- 参数

		- 参数1 shop   当前商品的数据对象 
		- 参数2 变化量

			- -1

### 3 定义对应的方法

- 接收两个参数

	- 当前商品数据对象
	- 变化量

- 1 结构商品数据对象,获取对应的商品skuId
- 2 判断最终的结果(表单中的值)是否大于0,如果大于0,则执行对应的代码,否则直接执行完毕
- 3 分发对应的action,传入对应的参数

## 登录注册退出登录的api函数的封装

### 请求登录

- export const reqLogin = (mobile, password) => ajax.post(`/user/passport/login`, { mobile, password })

### 注册

- export const reqRegister = (unerInfo) => ajax.post(`/user/passport/register`, unerInfo)
- 如果请求参数过多,可以使用对象的形式,进行传参

### 退出登录

- export const reqExitLogin = () => ajax.get(`/user/passport/logout`)

