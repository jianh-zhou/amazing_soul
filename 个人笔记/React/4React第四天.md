# 4 React第四天

## react 的异步请求

### 使用axios 

- 1 引入axios的插件,它是封装后ajax的一个插件.可以进行ajax的异步请求.
- 2 在componentDidMount生命周期回调函数中,进行异步请求,使用async和await或者then和catch,在其中的修改对应状态的值,最后实现异步请求
- ajax的风格是异步风格

### 使用fetch

- 这个方法是js原生的方法,使用时不需要引入,但是兼容性比较差,完全不支持IE浏览器,其他浏览器兼容性也不好,所以我们很少使用

## setState

### 是用来修改状态数据的方法,该方法可能是同步执行的,也可能是异步执行的

### 该方法调用后,会执行对应的生命周期回调函数,然后才会执行后面的代码

### 同步执行

- 1 在原生的DOM事件中,是同步操作的,也就是说,修改状态后,会执行render生命周期回调函数,然后执行后面的代码
- 2 使用了async 和await的函数中,也是同步执行
- 3 在定时器中也是同步执行
- 在这些同步执行时,会进行合并,也就是最终只会执行一次.也就是执行最后一次

	- 原理类似于,Object.asign()方法,该方法可以合并对象,如果多个对象中有一样的属性,则会进行覆盖操作,只有最后的属性值有效,

- 在异步代码中是同步执行,在同步代码中是异步执行

	- 异步就是会进行合并,而且只有在执行完同步代码后,然后真正进入setState的方法
	- 同步就是调用一次setState方法,会调用一次render方法,然后执行后面的代码,而且状态数据已经修改过了

### 异步执行

- 1 直接在生命周期回调函数中
- 2 在合成事件中,和正常的方法调用时,
- 在遇到定时器和setState时,setState是优先执行的

### 为了避免同步和异步问题,我们一般避免在一个方法中,多次修改state,一般只修改一次

## 消息订阅

### 消息订阅类似于自定义事件,即在一个地方绑定了一个事件,其他组件通过调用对应的方法,可以进行传递参数,它可以实现任意组件之间进行通信

### 1  引入对应的插件 

- import Pubsub from 'pubsub-js'

### 2 订阅消息

- 在componentDidMounte生命周期回调函数中,进行绑定
- this.token=Pubsub.subscribe('type',(msg,data)=>{})

	- 参数1 

		- 消息的名字

	- 参数2 

		- 回调函数两个参数,第一个参数是消息的名字,第二个参数是发布的消息

	- 该方法返回一个唯一 的标识,可以用来取消订阅,一般将该标识绑定在this上

### 3 发布消息

- 直接调用就可以进行发布消息
- Pubsub,publish('type',data)

	- 参数1 消息名字
	- 参数2 传递的数据

### 取消订阅

- 在componentWillUnmount生命周期回调函数中进行取消订阅.在该钩子中还会进行许多其他的解绑事件,清除定时器等操作

	- Pubsub.unsubScribe(this.token)
	- 可以使用消息的唯一标识进行清除,也可以传入消息名,就是清除所有该消息,如果不传任何参数,就是取消所有消息订阅

## 实现github的搜索用户功能

### 1 拆分组件,设置好对应的样式

- App组件
- Search组件(搜索)
- List组件(展示搜索内容)

### 在List组件中,设置是三个状态值

- isFirstView

	- 初始值为true

- isLoading

	- 初始值为false

- users

	- 初始值为[ ]

### 2 在List组件中对应的componentDidMount钩子函数中,进行消息订阅,消息订阅中会将所有代码

- 消息订阅的回调函数中

	- 1 开始请求,调用this.setState方法修改isLoading和isFirstView的值
	- 2 进行异步请求,使用axios
	- 3 请求成功则调用this.setState方法修改isLoading和users的值

### 3 给两个文本框设置为受控组件,设置初始的状态值,绑定onChange事件,

### 3 在Search组件中,给对应的按钮绑定事件,

- 1 收集文本框中的值,也就是定义的状态值
- 2 对状态值进行一些判断
- 3 发布List组件订阅的消息,文本框中的内容以对象形式传递过去

## react 中解决跨域

### 在packge.json进行配置,添加一个proxy选项,最终会解决跨域

- "proxy": "http://localhost:9527"

