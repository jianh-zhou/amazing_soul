# 2.ajax跨域解决及前后台交互的一些注意点

## 跨域的概念

### 在进行ajax请求时,才会有跨域的概念,正常情况下是没有跨域概念的

### 判断跨域的标准就是看ajax的请求地址,判断是否同源

- 1 协议
- 2 域名
- 3 端口号
- 三者都相等就为同源,就不存在跨域.只要有一个不等,就会存在跨域

## 1 jsoop 

### 解决跨域的原理

- 与ajax没有关系,只是利用巧妙的方法解决了跨域的问题

### 流程

- 1 创建一个script标签
- 2 给script标签添加一个src属性,该属性会携带一个回调函数标识
- 3 服务器会接收该函数,并且将所需要的数据作为函数的实参,返回给script标签的所在的文件中
- 4 页面会接收到该服务器所返回的函数,最终调用页面中的函数,最终可以操作数据,达到跨域请求的目的
- 4 使用完需要删除script标签,不然请求一次,会加载一个script标签,最终会造成内存泄漏

### script标签在加载时对应的数据时,使用的get请求方式

## 2 proxy

### 原理

- 利用代理进行请求数据
- 请求服务器数据时,因为跨域,而服务器与服务器之间是没有跨域的,我们可以利用我们自己的服务器去请求其他的服务器,将服务器请求的数据再返回给页面

### 流程

- 1 在页面请求时,将要请求的数据的参数以字符串拼接的形式传递给自身的服务器
- 2 服务器中引入request模块
- 3 app.get() 中写入调用request方法

	- request (参数1,参数2)

		- 参数1

			- 要请求的外部网址

		- 参数2 

			- 回调函数

				- (err,response,body)=>{ res.json(body)  }
				- body 

					- 请求返回的内容

				- response

					- response里面有一个包含body

## 3 服务器设置白名单

### 原理

- 直接在请求的服务器设置能请求的白名单

### 调用all方法

- app.all("*",(req,res,next)=>{  }

### 设置一个

- res.headers('Access-Control-Allow-Origin','http://127.0.0.1:1234/study')

### 设置相应的响应头格式

-  res.header("Access-Control-Allow-Headers", "content-type");
- 如果不设置这个,发送请求时(post),就设置不了请求头,会限制,服务器需要设置才能行

### 设置所有

- res.headers('Access-Control-Allow-Origin','*' )

### 设置多个

- 1 获取当前的请求地址

	- req.headers.origin

- 2 将可以访问的白名单网址用一个数组存起来,通过获取当前的请求地址,判断是否是白名单中的网址,如果是,则将其添加到响应的请求头

### all方法的next

- 调用该方法,只要符合接口设置,都会执行请求里面的代码,但只会响应一次

## 请求的注意点

### 1 需要设置接口,类似于/weibo这种,服务器请求时,接口也需要是这一个,才能进行返回响应

### 2 app.use(express.static(__dirname))

- 将当前服务器所在的文件夹作为静态资源文件夹
- 在访问当前当前网站下的文件夹时,如果是index.html,直接输入网址(jhttp://127.0.0.1:1234)即可打开该文件
- 如果是其他文件夹,需要安装路径进行进行文件,并写文件名

### 3 请求的地址不写前面的网址,直接写/weibo

- 直接就是站点的根目录,也就是说跟的是当前服务器拼接的是当前服务器的网址,不能直接打开该文件,要利用服务器打开,就不会跨域

## get请求的两种传参方式

### params

- 请求

	- http:127.0.0.1:1234/weibo/1/2

- 接收

	- app.get(weibo/:a/:b  
	- req.paramas.a
	- req.params.b

### query

- 请求

	- http://127.0.0.1:1234/weibo?a=1

- 接收

	- req.query.a

## post请求的参数接收

### 1 req.on('data'.chuck=>{ console.log(chuck.toString())

- 事件流

### 引入body-parser模块

- 1 const bodyParser=require('body-parser')

	- 引入模块

- 2 app.use(bodyParser.json() )

	- 将其接收的数据转换为对象

- 3 req.body

	- 得到的就是post请求的数据(对象的形式)

